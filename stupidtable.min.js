(function(c){c.fn.stupidtable=function(b){return this.each(function(){var a=c(this);b=b||{};b=c.extend({},c.fn.stupidtable.default_sort_fns,b);a.data("sortFns",b);a.stupidtable_build();a.on("click.stupidtable","thead th",function(){c(this).stupidsort()});a.find("th[data-sort-onload=yes]").eq(0).stupidsort()})};c.fn.stupidtable_settings=function(b){return this.each(function(){var a=c(this),f=c.extend({},c.fn.stupidtable.default_settings,b);a.stupidtable.settings=f})};c.fn.stupidsort=function(b){var a=
c(this),f=0,g=c.fn.stupidtable.dir,d=a.closest("table"),h=a.data("sort")||null;d.stupidtable.settings||(d.stupidtable.settings=c.extend({},c.fn.stupidtable.default_settings));if(null!==h){var k=d.data("sortFns")[h];a.parents("tr").find("th").slice(0,c(this).index()).each(function(){var a=c(this).attr("colspan")||1;f+=parseInt(a,10)});var e;1==arguments.length?e=b:(e=b||a.data("sort-default")||g.ASC,a.data("sort-dir")&&(e=a.data("sort-dir")===g.ASC?g.DESC:g.ASC));a.data("sort-dir",e);d.trigger("beforetablesort",
{column:f,direction:e,$th:a});d.css("display");setTimeout(function(){d.stupidtable.settings.will_manually_build_table||d.stupidtable_build();var b=d.data("stupidsort_internaltable");b.sort(function(a,b){var c=k(a.columns[f],b.columns[f]);return 0===c?a.index-b.index:c});e!=g.ASC&&b.reverse();var l={column:c.map(b,function(a,b){return[[a.columns[f],a.$tr,b]]}),sort_dir:e,$th:a,th_index:f,$table:d,datatype:h,compare_fn:k};d.stupidtable.settings.should_redraw(l)&&(trs=c.map(b,function(a){return a.$tr}),
d.children("tbody").append(trs),d.find("th").data("sort-dir",null).removeClass("sorting-desc sorting-asc"),a.data("sort-dir",e).addClass("sorting-"+e),d.trigger("aftertablesort",{column:f,direction:e,$th:a}),d.css("display"))},10);return a}};c.fn.updateSortVal=function(b){var a=c(this);a.is("[data-sort-value]")&&a.attr("data-sort-value",b);a.data("sort-value",b);return a};c.fn.stupidtable.default_settings={should_redraw:function(b){return!0},will_manually_build_table:!1};c.fn.stupidtable.dir={ASC:"asc",
DESC:"desc"};c.fn.stupidtable.default_sort_fns={"int":function(b,a){return parseInt(b,10)-parseInt(a,10)},"float":function(b,a){return parseFloat(b)-parseFloat(a)},string:function(b,a){return b.toString().localeCompare(a.toString())},"string-ins":function(b,a){b=b.toString().toLocaleLowerCase();a=a.toString().toLocaleLowerCase();return b.localeCompare(a)}};c.fn.stupidtable_build=function(){return this.each(function(){var b=c(this),a=[];b.children("tbody").children("tr").each(function(b,g){var d={$tr:c(g),
columns:[],index:b};c(g).children("td").each(function(a,b){var e=c(b).data("sort-value");"undefined"===typeof e&&(e=c(b).text(),c(b).data("sort-value",e));d.columns.push(e)});a.push(d)});b.data("stupidsort_internaltable",a)})}})(jQuery);
